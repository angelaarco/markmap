import"./disclose-version.Bg9kRutz.js";import"./legacy.BBZB6jHP.js";import{p as et,l as q,d as at,f as nt,t as b,b as rt,s as D,g as r,m as J,e as O,h as F,a as x}from"./utils.D1EJL-44.js";import{i as st,e as it}from"./if.V2DjeOVA.js";import{a as k,t as E}from"./template.CZkw3qFU.js";import{a as ot,e as ct,l as lt,g as B,t as ft,b as mt,u as dt,U as ut,c as pt,d as H,s as A}from"./common.BxGTHmpw.js";import{s as ht}from"./class.DsbGUC_w.js";import{b as gt}from"./props.h1s3Xk77.js";import{b as vt}from"./preload-helper.BAGBm9PM.js";import{i as yt}from"./lifecycle.DD7ZvZC7.js";import{p as d}from"./props.QVOWIKP-.js";import{o as wt}from"./index-client.Du6nrK6y.js";import{d as _t}from"./debounce.CLTjDgnO.js";var bt=E('<link rel="stylesheet" type="text/css">'),xt=E('<div class="markmap-highlight-area"></div>'),kt=E('<!> <!> <svg xmlns="http://www.w3.org/2000/svg"></svg>',1);function Ft(P,c){et(c,!1);const C=ot();let s=d(c,"mm",12),y=d(c,"el",12,null),p=d(c,"content",8,""),S=d(c,"style",8,""),U=d(c,"fit",8,!0),V=d(c,"class",8,""),G=d(c,"onReload",8,void 0),I=d(c,"onOpenLink",8,void 0);const R={};let u;const l=J({});let o=J();function K(t,e){let a=!1;return{promise:new Promise((i,f)=>{const h=performance.now(),m=()=>{const g=performance.now()-h,_=Math.min(g/t,1);if(e(_),_<1&&!a)return requestAnimationFrame(m);(a?f:i)()};requestAnimationFrame(m)}),abort:()=>{a=!0}}}function Q(t){let e=t?{x:t.x,y:t.y,width:t.width,height:t.height,opacity:1}:void 0;if(x(o,e),e){const{abort:a,promise:n}=K(500,i=>{if(e!==r(o))return a();e.opacity=1-i,x(o,e)});n.finally(()=>{e===r(o)&&x(o,void 0)})}}async function j(t){var a;if(!s())return;const e=Y(t);if(e){await s()[R.placement==="center"?"centerNode":"ensureVisible"](e,{bottom:60});const n=(a=s().findElement(e))==null?void 0:a.g,i=n==null?void 0:n.getBoundingClientRect();Q(i)}}const M=_t(()=>s().fit(),200);let N;async function v(t,e=!1){var a,n,i;if(s()&&(t!==N||e)){u=B().transform(t||"");const f=(a=u.frontmatter)==null?void 0:a.markmap;R.placement=(n=f==null?void 0:f.activeNode)==null?void 0:n.placement;const h=dt(f),{extraJs:m,extraCss:g}=f||{};r(l).js&&!W(r(l).js,m)?(i=G())==null||i():!r(l).js&&m&&(O(l,r(l).js=m),X()),O(l,r(l).css=g),N=t,await s().setData(u.root,{...ut,...h}),U()&&await s().fit()}}function W(t,e){return Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((a,n)=>a===e[n])}async function X(){await C,await pt(r(l).js.map(t=>({type:"script",data:{src:t}}))),v(p(),!0)}function Y(t){function e(n){var h,m,g;const[i,f]=((m=(h=n.payload)==null?void 0:h.lines)==null?void 0:m.split(",").map(_=>+_))||[];i>=0&&i<=t&&t<f&&(a=n),(g=n.children)==null||g.forEach(e)}let a;return u!=null&&u.root&&e(u.root),a}function Z(t){var a,n;const e=(a=t.target)==null?void 0:a.closest("a");if(e){const i=e.getAttribute("href");((n=I())==null?void 0:n(i))===!1&&t.preventDefault()}}async function $(){if(await C,!y())return;const t=[lt.tap(()=>{v(p(),!0)}),B().hooks.retransform.tap(()=>{v(p(),!0)})];return s(ft.create(y())),v(p()),window.addEventListener("resize",M),()=>{var e,a;window.removeEventListener("resize",M),t.forEach(n=>{n()}),(a=(e=s())==null?void 0:e.destroy)==null||a.call(e),s(null)}}wt(()=>{const t=$();return()=>{t.then(e=>e==null?void 0:e())}}),q(()=>(F(p()),H),()=>{try{v(p())}catch(t){console.error(t);const{message:e,stack:a}=t||{};H("event","exception",{description:e+`
`+a})}}),q(()=>F(s()),()=>{s()&&s().renderData()}),at(),yt();var z=kt(),L=nt(z);ct(L,1,()=>r(l).css||[],mt,(t,e)=>{var a=bt();b(()=>A(a,"href",r(e))),k(t,a)});var T=D(L,2);{var tt=t=>{var e=xt();b(()=>A(e,"style",`left:${r(o).x}px;top:${r(o).y}px;width:${r(o).width}px;height:${r(o).height}px;opacity:${r(o).opacity};`)),k(t,e)};st(T,t=>{r(o)&&t(tt)})}var w=D(T,2);return vt(w,t=>y(t),()=>y()),b(()=>{ht(w,`${V()} leading-none`),A(w,"style",S())}),it("click",w,Z),k(P,z),gt(c,"setCursor",j),rt({setCursor:j})}export{Ft as M};
